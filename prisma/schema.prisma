generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== Core ====================

model CoreAddress {
  address_id    Int       @id @default(autoincrement())
  address_line1 String
  address_line2 String?
  postal_code   String
  state         String
  city          String
  landmark      String?

  created_on    DateTime  @default(now())
  updated_on    DateTime  @updatedAt

  // Relations
  clinic        CoreClinic?

  @@map("core_address")
}

model CoreClinic {
  clinic_id                     Int         @id @default(autoincrement())
  clinic_registration_id        String
  clinic_name                   String
  speciality_tags               String[]
  clinic_desc                   String?
  consultation_validation       Boolean

  created_on                    DateTime    @default(now())
  updated_on                    DateTime    @updatedAt

  // Relations
  core_address                  CoreAddress @relation(fields: [address_id], references: [address_id])
  address_id                    Int         @unique
  core_transition_clinic_doctor CoreTransitionClinicDoctor[]

  @@map("core_clinic")
}

model CoreDoctor {
  doctor_id          Int       @id @default(autoincrement())
  specialization     String
  name               String
  medical_license    String    @unique
  rating             Float?
  start_date         DateTime
  end_date           DateTime?

  created_on         DateTime  @default(now())
  updated_on         DateTime  @updatedAt

  // Relations
  user               User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  user_id            Int       @unique
  appointments       Appointment[]
  core_transition_clinic_doctor CoreTransitionClinicDoctor[]

  @@map("core_doctor")
}

model CoreTransitionClinicDoctor {
  clinic_doctor_id Int       @id @default(autoincrement())
  clinic_id        Int
  doctor_id        Int

  clinic           CoreClinic @relation(fields: [clinic_id], references: [clinic_id], onDelete: Cascade)
  doctor           CoreDoctor @relation(fields: [doctor_id], references: [doctor_id], onDelete: Cascade)
  availabilities   CoreDoctorAvailability[]

  @@unique([clinic_id, doctor_id])
  @@map("core_transition_clinic_doctor")
}

model CoreDoctorAvailability {
  id               Int       @id @default(autoincrement())
  clinic_doctor_id Int
  available_date   DateTime
  start_time       DateTime
  end_time         DateTime

  clinicDoctor     CoreTransitionClinicDoctor @relation(fields: [clinic_doctor_id], references: [clinic_doctor_id], onDelete: Cascade)

  @@unique([clinic_doctor_id, available_date, start_time, end_time])
  @@map("core_doctor_availability")
}

model CorePatient {
  patientID         Int       @id @default(autoincrement())
  dob               DateTime
  gender            String
  blood_group       String
  contact_number    String    @unique
  address           String?
  emergency_contact String?

  created_on        DateTime  @default(now())
  updated_on        DateTime  @updatedAt

  appointments      Appointment[]
  user              User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  user_id           Int       @unique

  @@map("core_patient")
}

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}

model User {
  user_id    Int       @id @default(autoincrement())
  username   String    @unique
  password   String
  email      String    @unique
  role       Role

  created_on DateTime  @default(now())
  updated_on DateTime  @updatedAt

  patient    CorePatient?
  doctor     CoreDoctor?
  admin      Admin?

  @@map("user")
}

model Admin {
  admin_id        Int       @id @default(autoincrement())
  name            String
  contact_number  String    @unique
  address         String?

  user            User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  user_id         Int       @unique

  @@map("admin")
}

// ==================== Appointment ====================

model Prescription {
  prescription_id Int       @id @default(autoincrement())
  item_id         Int
  item_name       String
  quantity        Int
  doses           String
  date            DateTime
  notes           String?

  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  appointment     Appointment @relation(fields: [appointment_id], references: [appointment_id], onDelete: Cascade)
  appointment_id  Int         @unique

  @@map("prescription")
}

enum Status {
  SCHEDULED
  COMPLETED
  CANCELED
  RESCHEDULED
}

model Appointment {
  appointment_id  Int       @id @default(autoincrement())
  patient_id      Int
  doctor_id       Int
  prescription_id Int?
  date            DateTime
  time            DateTime
  status          Status
  follow_up_date  DateTime?
  notes           String?

  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt

  patient         CorePatient  @relation(fields: [patient_id], references: [patientID], onDelete: Cascade)
  doctor          CoreDoctor   @relation(fields: [doctor_id], references: [doctor_id], onDelete: Cascade)
  prescription    Prescription?

  @@map("appointment")
}
